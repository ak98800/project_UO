components:
- layout_properties: {slot: default}
  name: html_container
  properties: {format: restricted_html}
  type: RichText
container:
  properties:
    html: |
      <!-- Charger vis.js -->
      <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

      <!-- Barre de boutons -->
      <div style="margin-bottom: 10px;">
        <button onclick="switchToFree()">Vue libre</button>
        <button onclick="switchToVertical()">Vue verticale</button>
        <button onclick="switchToHorizontal()">Vue horizontale</button>
        <button onclick="downloadPng()">Exporter en PNG</button>
      </div>

      <!-- Conteneur du graphe -->
      <div id="mynetwork" style="width: 100%; height: 1000px; border: 1px solid #ccc;"></div>

      <!-- Script principal -->
      <script>
        let network;
        let nodesStore = null;
        let edgesStore = null;

        window.drawGraph = function(nodesData, edgesData) {
          console.log("üîÑ drawGraph called");

          const container = document.getElementById("mynetwork");
          if (!container) {
            console.error("‚ùå Container introuvable !");
            return;
          }

          nodesStore = new vis.DataSet(nodesData);
          edgesStore = new vis.DataSet(edgesData);

          const data = { nodes: nodesStore, edges: edgesStore };

          const options = {
            layout: {
              randomSeed: 2  // ‚û§ Fixe la disposition initiale pour √©viter la boule
            },
            physics: {
              enabled: false
            },
            interaction: {
              dragNodes: true,
              dragView: true,
              zoomView: true,
              navigationButtons: true,
              keyboard: {
                enabled: true,
                speed: { x: 10, y: 10, zoom: 0.02 },
                bindToWindow: true
              }
            },
            nodes: {
              shape: "ellipse",
              scaling: { min: 10, max: 30 },
              font: { size: 12 }
            },
            edges: {
              arrows: "to",
              smooth: false,
              color: { color: "#999999" },
              font: { align: "middle", size: 12 }
            }
          };

          network = new vis.Network(container, data, options);
          setTimeout(() => network.fit({ animation: true }), 300);  // ‚û§ Auto centrage
          console.log("‚úÖ Graphe libre affich√© avec a√©ration !");
        };

        function switchToVertical() {
          if (!network || !nodesStore || !edgesStore) return;
          network.setOptions({
            layout: {
              hierarchical: {
                enabled: true,
                direction: "UD",
                sortMethod: "hubsize",
                levelSeparation: 150,
                nodeSpacing: 150,
                treeSpacing: 300
              }
            },
            physics: false
          });
          console.log("üîÅ Vue verticale activ√©e");
        }

        function switchToHorizontal() {
          if (!network || !nodesStore || !edgesStore) return;
          network.setOptions({
            layout: {
              hierarchical: {
                enabled: true,
                direction: "LR",
                sortMethod: "hubsize",
                levelSeparation: 150,
                nodeSpacing: 150,
                treeSpacing: 300
              }
            },
            physics: false
          });
          console.log("üîÅ Vue horizontale activ√©e");
        }

        function switchToFree() {
          if (!nodesStore || !edgesStore) return;

          const container = document.getElementById("mynetwork");
          const data = { nodes: nodesStore, edges: edgesStore };

          const options = {
            layout: {
              hierarchical: false,
              randomSeed: 2
            },
            physics: false,
            interaction: {
              dragNodes: true,
              dragView: true,
              zoomView: true,
              navigationButtons: true,
              keyboard: {
                enabled: true,
                speed: { x: 10, y: 10, zoom: 0.02 },
                bindToWindow: true
              }
            },
            nodes: {
              shape: "ellipse",
              scaling: { min: 10, max: 30 },
              font: { size: 12 }
            },
            edges: {
              arrows: "to",
              smooth: false,
              color: { color: "#999999" },
              font: { align: "middle", size: 12 }
            }
          };

          network = new vis.Network(container, data, options);
          setTimeout(() => network.fit({ animation: true }), 300);
          console.log("‚úÖ Vue libre am√©lior√©e activ√©e !");
        }

        window.downloadPng = function() {
          if (!network) {
            console.error("‚ùå R√©seau non initialis√©");
            return;
          }

          const canvas = document.querySelector("#mynetwork canvas");
          if (!canvas) {
            console.error("‚ùå Canvas introuvable !");
            return;
          }

          const pngData = canvas.toDataURL("image/png");

          const a = document.createElement("a");
          a.href = pngData;
          a.download = "organigramme.png";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);

          console.log("‚úÖ PNG t√©l√©charg√© !");
        };
      </script>
  type: HtmlTemplate
is_package: true
